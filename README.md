# grove-tmux (gmux)

![CI](https://github.com/mattsolo1/grove-tmux/actions/workflows/ci.yml/badge.svg)

`gmux` is an interactive session manager for tmux, integrated with the Grove ecosystem. It transforms tmux into a context-aware development environment.

The core of `gmux` is a TUI that provides a real-time dashboard of your projects, Git repositories, and active development sessions. Inspired by [ThePrimeagen's tmux-sessionizer](https://github.com/ThePrimeagen/tmux-sessionizer).

![gmux-sessionizer-demo](https://raw.githubusercontent.com/mattsolo1/grove-tmux/main/.assets/gmux-sz.png)

## Features

### Live Sessionizer (`gmux sz`)

The `gmux sz` command opens a live, filterable dashboard of all your development projects. 

-   **Automatic Project Discovery**: Finds Git repositories in your configured search paths.
-   **Real-time Tmux Status**: Instantly see which projects have active tmux sessions (`●`), including the currently attached one (`●`).
-   **Live Git Status**: Get a compact, real-time summary of Git status for all active sessions (e.g., `↑1 ↓2 M:3 S:1 ?_5 +10 -4`).
-   **Claude AI Integration**: If `grove-hooks` is installed, `gmux` displays the status of active Claude AI sessions (e.g., running `▶`, idle `⏸`, completed `✓`).
-   **Smart Sorting**: Prioritizes projects with active tmux sessions, then sorts by most recently accessed.
-   **Hierarchical Worktree Display**: Automatically discovers and groups Git worktrees under their parent repository.

### Interactive Key Management (`gmux key manage`)

-   **TUI for Key Bindings**: An interactive table view to visually map, unmap, and edit project-to-key bindings.
-   **Fuzzy Project Search**: Quickly find and map any discovered project to an available key without leaving the interface.
-   **CLI Commands**: A full suite of commands (`add`, `update`, `edit`, `unmap`) for scripting and managing key bindings from the command line.

### Advanced Session Control

-   **Complex Session Launching**: Use `gmux launch` to script new sessions with specific window names, working directories, and complex, multi-pane layouts.
-   **Scripting & Automation**: A rich set of subcommands (`session exists`, `session kill`, `session capture`, `wait`) to control and monitor tmux from scripts.

## Dependencies

## Installation

Todo

## Configuration

`gmux` uses simple YAML files for configuration. It looks for them in `~/.config/grove/` first, and then `~/.config/tmux/` as a fallback.

### 1. Project Discovery

Create `~/.config/grove/project-search-paths.yaml` to tell `gmux sz` where to find your projects.

```yaml
# ~/.config/grove/project-search-paths.yaml
search_paths:
  # A friendly name for the path
  work:
    # The path to search for projects
    path: "~/Work"
    # Enable or disable this search path
    enabled: true

  personal:
    path: "~/Personal"
    enabled: true

# You can also add specific projects that aren't in search paths
explicit_projects:
  - path: "~/Code/dotfiles"
    enabled: true
```

### 2. Session Key Bindings

Create `~/.config/grove/tmux-sessions.yaml` to define your hotkeys. You can manage this file manually or using the `gmux key` commands.

```yaml
# ~/.config/grove/tmux-sessions.yaml
available_keys:
  - a
  - s
  - d
  - f
  - g
  - h
  - j
  - k
  - l

sessions:
  # Map key 'a' to the grove-tmux project
  a:
    path: "~/Work/grove-tmux"
    repo: "grove-tmux"
  # Key 's' is available but currently unmapped
```

### 3. Tmux Integration

`gmux` generates a tmux configuration file with your key bindings. To activate them, add the following line to your `~/.tmux.conf`:

```tmux
# ~/.tmux.conf

# Source the bindings generated by gmux
source-file ~/.config/grove/generated-bindings.conf
```

After changing key bindings with `gmux key manage` or other `gmux` commands, the generated file is updated automatically, and `gmux` will attempt to reload your tmux configuration.

## Usage

Here is an overview of the main commands. Use `gmux <command> --help` for more details.

| Command                     | Description                                                                   |
| --------------------------- | ----------------------------------------------------------------------------- |
| `gmux sz`                   | Open the interactive, live-updating sessionizer.                              |
| `gmux sz <path>`            | Directly create or switch to a session for the given path.                    |
| `gmux key manage` (or `km`) | Open an interactive TUI to manage session key bindings.                         |
| `gmux key list` (or `list`) | List all configured session key bindings.                                     |
| `gmux key add`              | Interactively map a discovered project to an available key.                     |
| `gmux key unmap <key>`      | Unmap a project from a key, making the key available again.                     |
| `gmux launch <session-name>`| Launch a new tmux session with advanced options (panes, commands, etc.).      |
| `gmux start <key>`          | Start a pre-configured session by its key.                                    |
| `gmux status`               | Show the Git status for all configured repositories.                            |
| `gmux session <subcommand>` | Subcommands to check (`exists`), terminate (`kill`), and inspect (`capture`) sessions. |
| `gmux wait <session-name>`  | Block until a specific tmux session is closed.                                |


## Development

To work on `gmux`:

1.  Clone the repository: `git clone https://github.com/mattsolo1/grove-tmux.git`
2.  Enter the directory: `cd grove-tmux`
3.  Build the binary: `make build`
4.  Run unit tests: `make test`
5.  Run end-to-end tests: `make test-e2e`

## License

This project is licensed under the MIT License.
